{"version":3,"sources":["Form.tsx"],"names":["Form","state","phoneNumber","setPhoneNumber","setLoginOTPVisible","loginVisible","setCountryCode","countryCode","loginOTPRequest","Context","inputRef","focusPhoneNumber","Keyboard","removeListener","keyboardDidHide","loginOTPPayload","success","React","useEffect","current","setNativeProps","style","length","styles","phoneOnTyping","placeholder","InteractionManager","runAfterInteractions","setTimeout","focus","blur","handleChangeText","text","isNaN","Number","handleCountrySelected","item","dismiss","iso2","handleSubmit","phone","isSubmitEnabled","phoneNumberLib","require","phoneUtil","PhoneNumberUtil","getInstance","currentCountry","phoneInfo","parse","isValidNumber","containerForm","textInput","colors","gray"],"mappings":"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","sourcesContent":["import React, {RefObject, useContext, useEffect, useRef} from 'react';\nimport {Keyboard, TextInput, View, InteractionManager} from 'react-native';\nimport CountryPicker from './CountryPicker';\nimport Button from './Button';\nimport styles from './styles';\nimport {colors} from '../../themes';\nimport {Context} from '../../core/Context';\nimport {Country} from './Login.interface';\nimport {getCountry, getDialCode} from '../../helpers';\n\nfunction Form() {\n  const {\n    state,\n    phoneNumber,\n    setPhoneNumber,\n    setLoginOTPVisible,\n    loginVisible,\n    setCountryCode,\n    countryCode,\n    loginOTPRequest\n  } = useContext(Context);\n\n  const inputRef = useRef<TextInput>();\n\n  useEffect(() => {\n    /**\n     * Focus keyboard when mounting\n     */\n    focusPhoneNumber();\n\n    return () => {\n      Keyboard.removeListener('keyboardDidHide', keyboardDidHide);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (state.loginOTPPayload?.success) {\n      setLoginOTPVisible(true);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.loginOTPPayload]);\n\n  React.useEffect(() => {\n    inputRef.current?.setNativeProps({\n      style: phoneNumber?.length ? styles.phoneOnTyping : styles.placeholder\n    });\n  }, [phoneNumber])\n\n  const focusPhoneNumber = () => {\n    if (loginVisible) {\n      InteractionManager.runAfterInteractions(() => {\n        setTimeout(() => inputRef.current?.focus(), 100);\n      });\n    }\n  }\n\n  const keyboardDidHide = () => {\n    if (loginVisible) {\n      inputRef.current?.blur();\n    }\n  }\n\n  const handleChangeText = (text: string) => {\n    if (isNaN(Number(text))) {\n      return;\n    }\n\n    setPhoneNumber(text);\n  };\n\n  const handleCountrySelected = (item: Country) => {\n    setTimeout(() => {\n      Keyboard.dismiss();\n    }, 0)\n\n    setTimeout(() => {\n      setCountryCode(item.iso2);\n      focusPhoneNumber();\n    }, 100)\n  };\n\n  const handleSubmit = () => {\n    Keyboard.dismiss();\n\n    loginOTPRequest({\n      phone: phoneNumber,\n      countryCode: getDialCode(countryCode)\n    });\n  };\n\n  const isSubmitEnabled = (): boolean => {\n    if (phoneNumber.length >= 9) {\n      const phoneNumberLib = require('google-libphonenumber');\n      const phoneUtil = phoneNumberLib.PhoneNumberUtil.getInstance();\n\n      const currentCountry = getCountry(countryCode);\n      const iso2 = currentCountry?.iso2;\n\n      const phoneInfo = phoneUtil.parse(phoneNumber, iso2);\n\n      return phoneUtil.isValidNumber(phoneInfo);\n    }\n\n    return false;\n  };\n\n  return (\n    <View style={styles.containerForm}>\n      <CountryPicker\n        onSelected={handleCountrySelected}\n        onCountryPickerShow={keyboardDidHide}\n      />\n      <TextInput\n        ref={inputRef as RefObject<TextInput>}\n        style={styles.textInput}\n        keyboardType=\"phone-pad\"\n        onChangeText={handleChangeText}\n        value={phoneNumber}\n        placeholder=\"Phone Number\"\n        maxLength={15}\n        selectionColor={colors.gray}\n        placeholderTextColor={colors.placeholder}\n      />\n      <Button enabled={isSubmitEnabled()} onPress={handleSubmit} />\n    </View>\n  );\n}\n\nexport default Form;\n"]}