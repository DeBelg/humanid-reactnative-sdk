{"version":3,"sources":["Form.tsx"],"names":["React","useContext","useEffect","useRef","useState","OTPInputView","View","Text","ActivityIndicator","styles","Context","getDialCode","getUniqueId","EventRegister","ON_SUCCESS","colors","Form","state","loginRequest","loginOTPRequest","phoneNumber","countryCode","clearState","resetReducer","otpRef","timerRef","timer","setTimer","loginOTPPayload","data","config","nextResendDelay","clearTimer","clearTimeout","current","countdown","setTimeout","loginPayload","success","exchangeToken","emitEvent","bringUpKeyBoardIfNeeded","handleOnCodeFilled","code","phone","verificationCode","deviceId","handleResendCode","formContainer","otpView","otpFieldStyle","otpHighlightStyle","loginFetching","loginOTPFetching","gray","resendCode"],"mappings":"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","sourcesContent":["import React, {useContext, useEffect, useRef, useState} from 'react';\nimport OTPInputView from './OTPInput';\nimport {View, Text, ActivityIndicator} from 'react-native';\nimport styles from './styles';\nimport {Context} from '../../core/Context';\nimport {getDialCode} from '../../helpers';\nimport {getUniqueId} from 'react-native-device-info';\nimport {EventRegister, ON_SUCCESS} from '../../core/eventManager';\nimport {colors} from '../../themes';\n\nfunction Form(): JSX.Element {\n  const {\n    state,\n    loginRequest,\n    loginOTPRequest,\n    phoneNumber,\n    countryCode,\n    clearState,\n    resetReducer\n  } = useContext(Context);\n\n  const otpRef = useRef<OTPInputView>(null);\n\n  const timerRef = useRef<NodeJS.Timeout>();\n\n  const [timer, setTimer] = useState(\n    state.loginOTPPayload?.data?.config?.nextResendDelay ?? 60\n  );\n\n  const clearTimer = () => clearTimeout(timerRef.current!);\n\n  useEffect(() => {\n    return () => clearTimer();\n  }, []);\n\n  useEffect(() => {\n    if (timer === 0) {\n      return;\n    }\n\n    function countdown() {\n      setTimer(timer - 1);\n    }\n\n    timerRef.current = setTimeout(countdown, 1000);\n\n    return () => clearTimer();\n  }, [timer]);\n\n  useEffect(() => {\n    if (timer === 0) {\n      setTimer(state.loginOTPPayload?.data?.config?.nextResendDelay ?? 60);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.loginOTPPayload]);\n\n  useEffect(() => {\n    if (state.loginPayload?.success) {\n      const {exchangeToken} = state.loginPayload.data;\n      EventRegister.emitEvent(ON_SUCCESS, exchangeToken);\n      clearState();\n      resetReducer();\n    } else if (!state.loginPayload?.success) {\n      setTimeout(() => {\n        otpRef.current?.bringUpKeyBoardIfNeeded();\n      }, 500);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.loginPayload]);\n\n  const handleOnCodeFilled = (code: string) => {\n    loginRequest({\n      phone: phoneNumber,\n      countryCode: getDialCode(countryCode),\n      verificationCode: code,\n      deviceId: getUniqueId()\n    });\n  };\n\n  const handleResendCode = () => {\n    loginOTPRequest({\n      phone: phoneNumber,\n      countryCode: getDialCode(countryCode)\n    });\n  };\n\n  return (\n    <View style={styles.formContainer}>\n      <OTPInputView\n        ref={otpRef}\n        pinCount={4}\n        style={styles.otpView}\n        codeInputFieldStyle={styles.otpFieldStyle}\n        codeInputHighlightStyle={styles.otpHighlightStyle}\n        keyboardType=\"phone-pad\"\n        autoFocusOnLoad={true}\n        onCodeFilled={handleOnCodeFilled}\n        editable={!state.loginFetching}\n      />\n      {state.loginOTPFetching ? (\n        <ActivityIndicator size=\"small\" color={colors.gray} />\n      ) : (\n        <Text\n          style={styles.resendCode}\n          onPress={timer === 0 ? handleResendCode : () => null}>\n          {timer !== 0\n            ? `Resend code in ${timer}`\n            : 'Click here to resend code'}\n        </Text>\n      )}\n    </View>\n  );\n}\n\nexport default Form;\n"]}